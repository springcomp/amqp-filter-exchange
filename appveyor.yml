image: ubuntu

before_build:
  - sh: mkdir ./sources
  - sh: git clone https://github.com/asdf-vm/asdf.git ./sources/asdf --branch v0.4.3
  - sh: ./sources/asdf/bin/asdf plugin-add elixir
  - sh: ./sources/asdf/bin/asdf plugin-add erlang
  - sh: ./sources/asdf/bin/asdf install erlang 21.0
  - sh: ./sources/asdf/bin/asdf install elixir 1.6.6
  - sh: ./sources/asdf/bin/asdf global erlang 21.0
  - sh: ./sources/asdf/bin/asdf global elixir 1.6.6
  - sh: export PATH="$PATH:/home/appveyor/projects/amqp-filter-exchange/sources/asdf/shims"
  - sh: which elixir
  - sh: sudo apt-get update
  - sh: sudo apt-get install --yes autoconf
  - sh: sudo apt-get install --yes build-essential
  - sh: sudo apt-get install --yes erlang-dev
  - sh: sudo apt-get install --yes fop
  - sh: sudo apt-get install --yes libncurses5-dev
  - sh: sudo apt-get install --yes libreadline-dev
  - sh: sudo apt-get install --yes libssl-dev
  - sh: sudo apt-get install --yes libwxgtk3.0-dev
  - sh: sudo apt-get install --yes libxml2-utils
  - sh: sudo apt-get install --yes m4
  - sh: sudo apt-get install --yes unixodbc
  - sh: sudo apt-get install --yes unixodbc-bin
  - sh: sudo apt-get install --yes unixodbc-dev
  - sh: sudo apt-get install --yes wx-common
  - sh: sudo apt-get install --yes xsltproc
  - sh: sudo apt-get install --yes zlib1g-dev
  - sh: git clone https://github.com/rabbitmq/rabbitmq-public-umbrella.git ./sources/rabbitmq-public-umbrella
  - sh: which elixir
  - sh: make -C ./sources/rabbitmq-public-umbrella co

build_script:
  - sh: which elixir
  - sh: make dist

artifacts:
  - path: plugins/amqp_filter_exchange*.ez
    name: plugin
    type: file
